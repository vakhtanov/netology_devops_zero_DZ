# Домашнее задание к занятию «Компоненты Kubernetes»

### Цель задания

Рассчитать требования к кластеру под проект

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания:

- [Considerations for large clusters](https://kubernetes.io/docs/setup/best-practices/cluster-large/),
- [Architecting Kubernetes clusters — choosing a worker node size](https://learnk8s.io/kubernetes-node-size).

------

### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

----

### Правила приёма работы

1. Домашняя работа оформляется в своем Git-репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Сначала сделайте расчёт всех необходимых ресурсов.
3. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.
4. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды. 
5. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные. 
6. В результате должно быть указано количество нод и их параметры.

-----
### Решение

Необходимые ресурсы
|             | CPU | RAM (Gb)| Реплики | Сумма CPU | Сумма RAM (Gb) |
|-------------|-----|---------|---------|-----------|----------------|
| База данных | 1   | 4       | 3       | 3         | 12             |
| Кеш         | 1   | 4       | 3       | 3         | 12             |
| Фронтенд    | 0.2 | 0.05    | 5       | 1         | 0,25           |
| Бекенд      | 1   | 0.6     | 10      | 10        | 6              |
| **Итого**   |     |         | 21      | 17        | 30.25          |

Для функционарования самой ноды потребуется 1 CPU и 1 Gb RAM учтем это далее.
В задании не уточняется неободимый объем хранения для каждого сервиса. Будем считать, что данные для базы данных хранятся на внешнем хранилище, отогда для каждой ноды можно взять жеский диск объемом 40 Гб - этого хватит для операционной системы и приложений.
Объективно - чем больше отдельных нод - тем более устойчив кластер - выход из строя одной нобы менее заметен.
Предварительно прикинем возможное количество нод и их стоимость в облаке яндекс учитывая общий объем CPU=17 RAM=30.25
Брать ноды с двумя процессорами - не целесообразно - будут большие накладные расходы

| Типовая конфигруация ноды | Расчетное <br> количество нод | Проверка суммарных ресурсов <br> есть / требуется | Цена ноды <br> (тыс.руб.) | Общий бюджет с учетом <br> запасной ноды (т.р.) | 
|---------------------------|----------------|--------------------------------------------|-----------|----------------|
| 4 CPU, 8 RAM, 40 HDD      | 6              | 24CPU 48RAM <br> 23(17+6)CPU 37(30.3+6)RAM | 5.1       |  35.7  (6+1)   |
| 6 CPU, 12 RAM, 40 HDD     | 4              | 24CPU 48RAM <br> 21(17+4)CPU 34(30.3+4)RAM | 7.6       |  38    (4+1)   |
| 8 CPU, 12 RAM, 40 HDD     | 3              | 24CPU 36RAM <br> 20(17+3)CPU 33(30.3+3)RAM | 8.4       |  33.6  (3+1)   |

По цене и утилизации ресурсов наиборее оптимальна конфигруация worker node -  8 CPU, 12 RAM, 40 HDD 
для control node берем рекомендуемую конфигурацию - 2 CPU, 4 RAM, 40 HDD  2.6 т.р. в месяц
Итого:
| Тип ноды               | Конфигурация            | Количество| Цена т.р. | Всего т.р.|
|------------------------|-------------------------|-----------|-----------|-----------|
| worker node            | 8 CPU, 12 RAM, 40 HDD   | 4 (3+1)   | 8.4       | 33.6      |
| control node           |  2 CPU, 4 RAM, 40 HDD   | 3         | 2,6       | 7.8       |
| **ИТОГО** <br> в месяц |                         | 7         |           | 41.4      |
