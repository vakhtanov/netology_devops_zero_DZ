# Домашнее задание к занятию Troubleshooting

### Цель задания

Устранить неисправности при деплое приложения.

### Чеклист готовности к домашнему заданию

1. Кластер K8s.

### Задание. При деплое приложение web-consumer не может подключиться к auth-db. Необходимо это исправить

1. Установить приложение по команде:
```shell
kubectl apply -f https://raw.githubusercontent.com/netology-code/kuber-homeworks/main/3.5/files/task.yaml
```
2. Выявить проблему и описать.
3. Исправить проблему, описать, что сделано.
4. Продемонстрировать, что проблема решена.

---
### Решение

![]()
![]()
![]()

```
проблема с доступом состоит в то, что web-consumer и auth-db находятся в разных namespace и по умолчанию изолированы. Получить доступ по короткому имени не получится.

Можно
- для web-consumer изменить намеспейс на data

apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-consumer
  namespace: data
spec:
  replicas: 2
  selector:
    matchLabels:
      app: web-consumer
................

- или дать приложению web-consumer достпу по  полному имени сервиса - auth-db.data.svc.cluster.local

apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-consumer
  namespace: web
spec:
  replicas: 2
  selector:
    matchLabels:
      app: web-consumer
  template:
    metadata:
      labels:
        app: web-consumer
    spec:
      containers:
      - command:
        - sh
        - -c
        - while true; do curl auth-db.data.svc.cluster.local; sleep 5; done
        image: radial/busyboxplus:curl
        name: busybox
............................

- или создать Service типа ExternalName в namespace web и обращаться к нему

apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-consumer
  namespace: web
spec:
  replicas: 2
  selector:
    matchLabels:
      app: web-consumer
  template:
    metadata:
      labels:
        app: web-consumer
    spec:
      containers:
      - command:
        - sh
        - -c
        - while true; do curl auth-db-web; sleep 5; done
        image: radial/busyboxplus:curl
        name: busybox
---
apiVersion: v1
kind: Service
metadata:
  name: auth-db-web
  namespace: web
spec:
  type: ExternalName
  externalName: auth-db.data.svc.cluster.local

........................................

```

**попробуем 3й вариант**



![]()
### Правила приёма работы

1. Домашняя работа оформляется в своём Git-репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд, а также скриншоты результатов.
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md.
