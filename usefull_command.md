### Стандартный пароль к VM Windows *Passw0rd!*  
[коробки с операцинными системами](https://www.osboxes.org/ubuntu/)

`sudo apt install mc` - установить коммандер  

### Инфа о системе

`cat /etc/os-realease` - релиз операционки  
`uname -a ` - информация о типе системы и версии ядра
`lsb_release -a` - информация о сборвке и версии
`lscpu` - информация о процессоре
`lshw` - информация об аппаратных ресурсах

`echo $SHELL` - текущая оболочка  
`cat /etc/shells` - установленные оболочки  

`pidof [proc name]` - показывает PID процесса с именем  
`tee` - читает из stdin и напрвляет куда надо можно одновременно вывести на экран и записать    
`$$` - PID текущего процесса  
`id, sudo id` - информация о текущем пользователе и группах в которых он состоит  

`type NAME` - тип объекта  
`which NAME` - где исполняемый файл

`w` - действующие сессии терминала  
`whoami` - имя текущего пользователя  
`export NAME=XXXXX` - задать переменную во все дочерние процессы   
`NAME=XXXXX` - задать переменную в текущей оболочке  
`export -n NAME` - удаление переменной  

`lscpu` `cpuinfo` - инфа о проце  

`uname -a или uname -r` - версия ядра
glibc - библиотека для общения с системмнымии вызовами

`wc -l` - счетчик линий  
`wc -w` - счетчик слов  
`wc -m` - счетчик символов  

`file NAME` - показывает тип файла  
`command -v NAME` - показывает что запустит комманда  

`/bin, /usr/bin, /sbin, /usr/sbin` — исполняемые файлы (программы)  
`/boot — файлы загрузчика/dev` — представление устройств в виде файлов  
`/etc` — конфигурационные файлы/home  
`/home/inus` — домашний каталог пользователя linus __Можно класть в оделный раздел для большего места для пользователей__  
`/root` — домашний каталог пользователя root  
`/lib, /usr/lib` — библиотеки и модули ядра  
`/tmp` — каталог для временных файлов (очищается после перезагрузки)  
`/var` — каталог для изменяющихся файлов: логи, базы данных и т. д. __Можно класть в оделный раздел для защиты от переполнения__  
`/usr/local, /opt` — каталоги для программ, которые устанавливаются вручную  

### Комманды оболочки
`pwd` - выводит полный путь до текущего
`cat` - вывести на экран содержимое файла  
`less` - мощьный текстовый пейджер, возможности навигации как у ман  
`more` - постраничный текстовый пейджер, возможности навигации как у ман  
`head, tail` - начало и конец
`\СИМВОЛ` - экранирование символа он будет использоваться как есть, специальное назначение игнорируется  
Выключение: `systemctl poweroff` — аналог устаревшего `shutdown -P now`  
Перезагрузка: `systemctl reboot` — аналог устаревшего `shutdown -r now`  
`sudo -i` - зайти под другим пользователем, в данном случае root, или указать пользователя 
если у рута не задали пароль при установке, то sudo запрашивает пароль текущего пользователя  
`su -` - старая версия sudo работате если у рута есть пароль  
*__Пользователь без пароля не зайдет в систему!!!__*\
`ls -l` - просмотр аттрибутов файлов\
`ls -a` - просмотр всех файлов включая скрытые\
`ls -ld` - просмотр аттрибутов дирректории\
`ls -lh` - просмотр в человекочитаемом виде\
`touch FILE` - создать новый файл и/или обновить дату редактирования файла\
`truncate -s 0 /path_to_file` - очистка логов, обнуление файлов\
`rm FILE` -удаление файла\
`rm -v FILE` -удаление файла c выводом на экран отчета об операциях\
`rm -r DIR` -удаление всего каталога с содержимым\
`-i` - интерактивный режим, с запросами\
`mkdir DIR, rmdir DIR` - создать, удалить пустые именно директории\ 
`-p`- дерево каталогов\
`-f` - без запроса\
`cp FILE1 FILE2 DIR, cp FILE FILE_TARGET/DIR, mv FILE1 TARGET` - копирвоать/переместить(переименовать) файл\
`-r` - копировать рекурсивно - для каталогов\
`chmode +x` - изменить права, в частности добавить права на исполнение\

`lsblk` - показывает перечень блочных устройств и их точки монтирования\
`df -h` - показать свободное место на устройствах\
`du -sh /DIR` - размер директории\
`sudo mount /dev/УСТРОЙСТВО_РАЗДЕЛ /MOUNTING_POINT` - монитрование раздела в в определенный каталог\


###Типф файлов в системе\
*Обычные файлы* - `-`\
*Каталоги* - `d`\
*Файлы символьных устройств* - `c` - консоли\
*Файлы блочных устройств* - `b` - диски\
*Сокеты (локальные)* - `s` - передача данных между программами\
*Каналы (pipe)* - `p` - передача данных между программами\
*Ссылки* - `l`\

### Редактор VI VIM  
`Insert клавиша` - переход в режим редактирвоания  
`ESC клавиша` - переход в режим навигации и комманд  
`:wq!` - записать и выйти  
`:q!` - выйти  
`vimtutor` - справка по вим  
еще есть `nano` и `mc`  
`mc` - коммандный менеджер  


### Объединение комманд  
[Справка по объединению](https://housecomputer.ru/os/unix/Operators_combining_teams.html)  
`&` - в конце отправить в фон  
`;` - между коммандами - последовательное выполнение  
`&&` (логическое И) - следующая выполнится только если пердыущая успешно выплнилась - код выхода 0  
`||` (логическое ИЛИ) - следующая выполнится только если пердыущая  выплнилась НЕ УСПЕШНО 

### Работа с потоками  
stdin - 0
stdout - 1
stderr - 2
`cmd < FILE` - напрвить файл в комманду  
`CMD > FILE` - вывод комманды в файл заменить  
`CMD >> FILE` - вывод комманды в файл дописать  
`CMD 2> FILE` - вывод ошибок в файл  
`CMD1 | CMD2` - вередать вывод первой команды на вход второй  
`find /etc > /dev/null` - стандартный вывод уходит на нулевое устройство, на экран выведутся только ошибки!!!   
`2>&1` - поток ошибок направить в первый поток  
`>&2` - стандартный поток в поток ошибок и он, возможно, выведется на экран  


### Фоновые процессы
`ctrl+z` - отправить процесс в фон - он останавливается  
`ctrl+d` - заверщить процесс   
`ctrl+с` - прервать процесс  
`jobs` - процессы в фоне  
`fg %НОМЕР` - переключение на процесс  

`ctrl+l` - очистить экран    
`ctrl+r` - поиск комманд  

### Работа с APT
`sudo apt update` — обновление индекса пакетов: скачивание информации из репозитория о имеющихся версиях  
`sudo apt upgrade` — обновление самих пакетов  
`sudo apt install package` — установка пакета с названием package  
`sudo apt remove package` — удаление пакета package из системы  
`sudo apt autoremove` — удаление неиспользуемых зависимостей  


### Работа с экранами  
`screen` - запуск экрана  
`exit` - выйти из приложения экранов  
`ctrl+а d ` - пеерключиться на основную сессию bash  
`screen -r` - вернуться в screen  
`reptyr PID` - подключиться к процессу - переместить процесс в текущую сессию  

---

### Работающие процессы

`ps auxf` - процессы и их дерево  
`a` – убирает ограничение о собственных процессах,  
`u` – добавляет расширенный набор часто нужных колонок,  
`x` – убирает ограничение о процессах, запущенных из текущего терминала,  
`w/ww` – убирает ограничение по длине вывода  
`-u` - конкретного пользователя  
`ps ax -o stat --sort=stat` сортировка по статусу  

`echo -n D=; ps -A -o stat | grep D -c` считает количество процессов статуса D  
`pstree -a -p` - дерево процессов  
`lsof` - открытые файлы все  
*флаги*  
`lsof -p XXXX` - открытые файлы конкретного процесса  
`lsof -p $$` - открытые файлы текщей сессии баш  
`lsof -u NAME` - открытые файлы пользователя  
`lsof -U` - открытые файлы сокетов. Сокеты - каналы обмена между процессами - лежат в памяти 
`lsof -c NAME` - файл открытые процессом  
`cat /dev/null > /proc/PID/fd/FD` - обнулить открытый файл PID процесса с FD  
или `echo > /proc/PID/fd/FD`  
`/proc/PID/fd/FD` - конкретный открытый файл  

### vagrant  
`vagrant up` - запустить  
`vagrant suspend` - мягко выключить  
`vagrant halt` - жестко выключить  
`vagrant box add e3801813-59e0-4e69-8ace-78362d9f47cf --name bento/ubuntu20.04`  - добавить образ
`vagrant init bento/ubuntu20.04 `  инициализировать дирректорию  

### Мониторинг системмных вызовов  
`strace` - моинторинг комманды  
*флаги* 
`strace -e KEY` - вывод только конкреных вызовов   
`strace -f ` - вывод дочерних процессов тоже  
`strace -p XXX ` - подключиться к конкретному процессу 
`strace -P XXX ` - системмные вызовы определенного пути  
`pidof NAME` - PID процесса с именем  
`strace -f sh -c ls` - следить за вызовами ls в sh  
`strace -f sh -c ls` `-c` - передать в sh комманду ls  
`strace -f bash -c 'cd /tmp'`  
`strace -s 65000` - вывести полные строки - по умолчанию 32 байта   
`strace -y` - аннотации к фаловым дискрипторам   
`strace -e openat` - фильтр по вызову    
 
 #### Выводы starce  
 openat - открывает файл и присваивает дескриптор  
 read - читает данные  
 close(3) - закрывает файл  
 write - пишет в файл  
 stat - пытается вызвать файл по переданному пути  

### Работа с руководством  
 *В руководстве много разделов и все они сразу не показываются, в документации есть ссылк ина них, например `man(2)`, ссылка на второй раздел*
`man NAME` - поиск справки по комманде  
`man bash` - справка по встроенным коммандам  
`man N NAME` - поиск справки по комманде в разделе N  
`man 7 man`  
`man -f man` - показать все разделы по комманде  
`man -k printf` - поиск комманд где есть `prinf`  
`man -k 'user ' | grep password` - поиск по комманде user где в тексте есть password  
*Поиск внутри руководства - нажимаем `/` пишем слово. Вперед - `n`, назад `N`*  
*Поиск внутри руководства - нажимаем `&` пишем слово. Все лишние строки скрываются,*  
*Внутри руководства нажимаем `-N` enter - показваюстя номера строки*  
*Внутри руководства нажимаем `-n` enter - убрать номера строки*  
*Внутри руководства нажимаем `234g` перейти на 234 строку*  

### Работа с SET  
 *меняет режимы работы bash*  
`set` - текущие настройки    
`set -euxo pipefail` хорошо было бы использовать в сценариях - при ошибках обращения и выполнения - скрипт немедленно завершается и выполняется трассировка  


### Работа с Test 
 *проверяет типы фалов и сравнивает значения*  
`test -d DIR` - существует ли путь и является ли дирректорией  
`test -e FILE` - существует ли файл  

### Работа с GREP  
`grep WHAT FILE` - поиск чегото в файл  
`-c` - подсчитать количество вхождений  
`-v` - исключить искомы строки в выводе  
`-i` - игнорировать регистр  
`grep '^vim'` - в начале строки стоит vim



### Мониторинг  системы   
`free -m` - использование памяти  
`echo 3 >/proc/sys/vm/drop_caches` - очистить кеш устройств  
`top` - монитор ресурсов, `shift+f` - управление  
`htop` - современный вариант top  
`atop` - запись в файл  
`iotop`  
`iftop`  



### Работа с KILL   
`kill -HUP $(cat /var/run/nginx.pid)` - Нередко HUP командует процессу перечитать свои конфигура  
kill dash nine - завершить по коду 9 - полностью преррвать  
обычно надо по коду 15! - штатное завершение  

### DNS сервера

77.88.8.8 — Yandex  
77.88.8.1 — Yandex  
8.8.8.8 — Google  
8.8.4.4 — Google  

```
Список полезной литературы  
«Unix и Linux: Руководство системного администратора», Эви Немет, Гарт Снайдер, Трент Хейн, Бен Уэйли, Дэн Макни.  
«TCP/IP. Сетевое администрирование», Хант Крэйг.  
«Компьютерные сети. Принципы, технологии, протоколы», Олифер Виктор Григорьевич, Олифер Наталия Алексеевна.  
«Компьютерные сети», Эндрю Таненбаум, Дэвид Уэзеролл.  
«Современные операционные системы», Эндрю Таненбаум, Херберт Бос.  
«Архитектура компьютера», Эндрю Таненбаум, Тодд Остин.  
«Установка, настройка, администрирование», Михаэль Кофлер.  
«Удалённый сервер своими руками. От азов создания до практической работы», Николай Левицкий.  
«Внутреннее устройство Linux», Брайан Уорд.  
«Администрирование сетей Cisco: освоение за месяц», Пайпер Б.  
«Сценарии командной оболочки. Linux, OS X и Unix». Серия «Для профессионалов».  
«Penetration Testing with the Bash shell», Keith Makan.  
«Pro Bash Programming Scripting the GNU/Linux Shell», Chris F. A. Johnson, Jayant Varma.  
```
