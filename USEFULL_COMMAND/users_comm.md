

# Про пользователй в Линукс

root - UID = 0, GUID = 0

`cat /etc/passwd` - список пользователей системы  
`cat /etc/group` - список групп пользователей системы  
`cat /etc/sudoers` - кто может использовать sudo  
`cat /etc/login.defs` - параметры входа по умолчанию  
`/etc/security/limits.conf` – файл, содержащий ограничения ресурсов  

`w` - действующие сессии терминала  
`whoami` - имя текущего пользователя  
`id` - информация про текущего пользователя  
`visudo` - у кого есть права суперпоьлзователя, редактируем файл /etc/sudoers  
`/etc/shadow` - хеш пароля  

`echo $PATH` - переменная path
cat ~/.bashrc - файл с настройками для пользователя\
добавление в Path для пользователя
```bash
PATH=$PATH:/usr/local/bin/
export PATH
```

#### переменные окружения
* HOME=/home/user – домашний каталог пользователя
* LOGNAME=user – имя пользователя в текущей оболочке
* PWD=/home/user – текущий рабочий каталог
* SHELL=/bin/bash – командная оболочка
* LC_*=ru_RU.UTF-8 – переменные для локализации
* LANG=en_US.UTF-8 – язык системы

`cd` - перейти в домашнюю папку пользователя  

#### права на файл  
-rwx rwx rwx  -r-- rw- rwx  
-421 421 421   chmod 467  
#### специальные биты
`Setuid (suid)` – позволяет пользователю выполнять программу с правами владельца файла (s в атрибутах файла)\
`Setgid (sgid)` – работает аналогично setuid, но для группы Для большей безопасности при монтировании ФС можно указать параметр `nosuid` для отключения флагов `suid` и `setgid`\
`Sticky` – в таком каталоге пользователь может удалять только свои файлы (t в атрибутах файла)

chmod (change mode) – утилита для изменения прав доступа
* `chmod +x <file> chmod -x <file>`
* `chmod g+r <file> chmod g-r <file>`
* `chmod o+w <file> chmod o-w <file>`
* `chmod 660 <file>`
* `chmod u+s <file>` – установка SUID
* `chmod g+s <file>` – установка SGID
* `chmod +t <file>` – установка Sticky

`chown (change owner)` – утилита для изменения владельца файла\
`chgrp (change group)` – утилита для изменения групп\
`umask (user mask)` – задает биты доступа, устанавливаемые по умолчанию для всех новых файлов\
__Umask__ обладает «инверсной» логикой, т.е. маска "вычитается" из прав по умолчанию (0666 для файла и 0777 для каталога).

`sudo` - получить права суперпользователя  
`sudo su`, `su -` - перейти под root  
`su NAME` - переключиться под пользователя с вводом пароля  

`openssl -6 PASSWORD` - получить хеш пароля

__Для добавления новго пользователя Артур раскатывает плейбук из Ansible__

### Пользователи
* `useradd -D` – выполнить команду со стандартными параметрами
* `sudo useradd testuser` – из-под root добавить пользователя testuser
* `sudo useradd testuser -s /bin/bash` – из-под root добавить пользователя указав bash как оболочку
* `useradd -c "Test User" -e 2023-12-31 test` – добавить пользователя с комментарием "Test User" и автоматической блокировкой 2023-12-31
* `su test` – переключиться (Switch User) на пользователя test
* `usermod --lock testuser` – заблокировать пользователя testuser
* `usermod -p <пароль> testuser` – сменить пароль пользователя, указав пароль в команде. Пароль должен быть в зашифрованном виде
* `openssl passwd -6 moi_porol` - пароль в защифрованном виде
* `sudo passwd testuser` – сменить пароль пользователя, указав пароль в интерактивном диалоге
* `sudo userdel testuser` – удалить пользователя
* `usermod -aG test2 test` # Добавить пользователя test в группу test2

### Группы
* `groupadd ctf` – добавить группу ctf
* `groupmod -n ctf ftc` – переименовать группу ftc в ctf
* `sudo groupdel ftc` – удалить группу ftc


## Восстановления пароля ОС
нажать Е при загрузке

* Выбираем расширенные параметры загрузки1
* Выбираем recovery mode2
* Выбираем root3
* Вводим: mount -o remount,rw /4
* Вводим: passwd user5
* Вводим: exit или shutdown -r now

второй способ - если не работает recovery - исправить файл /boob/grub/grub.cfg
секция menuentery  
в конец строки загрузкия ядра добавляем строку `init=/bin/bash`
